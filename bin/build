#!/usr/bin/env bash
# bin/build - Heroku build script

set -e

echo "----> Running custom build script for Clojure Trader"

# Use system lein if available, otherwise use the one in .lein/bin
if command -v lein &> /dev/null; then
  echo "----> Using system lein"
  LEIN_CMD=lein
else
  echo "----> Using lein from .lein/bin"
  LEIN_CMD=.lein/bin/lein
fi

# Print versions for debugging
echo "----> Java version:"
java -version

echo "----> Building uberjar with $LEIN_CMD"
$LEIN_CMD uberjar

# Verify the JAR was created
if [[ -f target/uberjar/clojure-trader-0.1.0-SNAPSHOT-standalone.jar ]]; then
  echo "----> Successfully built target/uberjar/clojure-trader-0.1.0-SNAPSHOT-standalone.jar"
  ls -lh target/uberjar/clojure-trader-0.1.0-SNAPSHOT-standalone.jar
else
  echo "----> Failed to build JAR. Contents of target/:"
  ls -la target/
  echo "----> Contents of target/uberjar/ (if it exists):"
  if [[ -d target/uberjar ]]; then
    ls -la target/uberjar/
  fi
  exit 1
fi

# Make the build script executable
chmod +x bin/release

echo "----> Build completed successfully" 