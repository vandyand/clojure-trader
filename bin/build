#!/usr/bin/env bash
# bin/build - Heroku custom build script

set -e  # Exit immediately if a command exits with a non-zero status

echo "----> Running custom build script for Clojure Trader"

# Find lein executable - either use system lein or local lein
if command -v lein &> /dev/null; then
  echo "----> Using system lein"
  LEIN_CMD="lein"
elif [[ -f ./lein && -x ./lein ]]; then
  echo "----> Using local lein"
  chmod +x ./lein
  LEIN_CMD="./lein"
else
  echo "ERROR: No lein executable found"
  exit 1
fi

# Build the uberjar
echo "----> Building uberjar with $LEIN_CMD"
$LEIN_CMD clean
$LEIN_CMD uberjar

# Verify uberjar was built
if [[ ! -f target/uberjar/clojure-trader-0.1.0-SNAPSHOT-standalone.jar ]]; then
  echo "ERROR: Failed to build uberjar"
  exit 1
fi

echo "----> Custom build completed successfully" 